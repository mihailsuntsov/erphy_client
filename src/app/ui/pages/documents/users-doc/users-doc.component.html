<mat-card appearance="outlined" class="card for-sticky-header" *transloco="let t">
    <mat-card-header>
        <mat-card-title class="top-bar container-fluid"> 
                <div class="row" id="topBlock">
                        <div class="card-name">{{t('docs.docs.user')}}</div>
                                <button 
                                        mat-raised-button 
                                        matTooltip="{{t('docs.tip.create')}}"
                                        (click)="onSubmit()" 
                                        *ngIf="allowToCreate && +id==0 "
                                        [disabled]="!formBaseInformation.valid||oneClickSaveControl||!additionalChecksValid" 
                                        color="primary"
                                        type="submit"
                                        class="button small-button">
                                        <i class="material-icons">done</i>
                                </button>
                                <button 
                                        mat-raised-button 
                                        *ngIf="+id>0 && allowToUpdate && allowToView"
                                        matTooltip="{{t('docs.tip.save')}}"
                                        (click)="updateDocument()"
                                        [disabled]="!formBaseInformation.valid||oneClickSaveControl||!additionalChecksValid" 
                                        color="primary"
                                        type="button"
                                        class="button small-button">
                                        <i class="material-icons">save</i>
                                </button>
                                <a routerLink="../{{+id>0?'../':''}}users">
                                <button 
                                        [matTooltip]="id>0?t('docs.tip.exit'):t('docs.tip.cancel')"
                                        mat-raised-button 
                                        color="accent"
                                        class="button small-button">
                                        <i class="material-icons">close</i>
                                </button>
                                </a>
                </div>
        </mat-card-title>
    </mat-card-header>
<!-- !!! -->
<mat-card-content *ngIf="rightsDefined && 
(
    (!allowToView && +id>0) ||
    (!allowToCreate && +id==0)
)"> 
    <mat-card appearance="outlined" class="internal-card">
        <mat-card-content style="font-size: 20px;font-weight: bold;color: red;text-align: center;height: 100px;padding: 38px 0;">
            {{t('docs.msg.no_perm')}}
        </mat-card-content>
    </mat-card>
</mat-card-content>
<!-- !!! -->
<mat-card-content *ngIf="!rightsDefined || (rightsDefined && (( +id>0 && allowToView)||(+id==0 && allowToCreate)))"> 

        <form [formGroup]="formBaseInformation">   
                <mat-tab-group>
                        <mat-tab label="{{t('docs.tab.info')}}">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-lg-4 col-xl-4 col-md-6 col-12">  
                                        <mat-card appearance="outlined" class="internal-card">
                                            <mat-card-header>
                                                <mat-card-title class="card-title">{{t('docs.card.base_info')}}</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form">

                                                <mat-form-field style="display: none">
                                                    <input  matInput
                                                            placeholder="id"
                                                            formControlName="id"/>
                                                </mat-form-field>
                                                <div class="row">
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100"  >
                                                            <mat-label>{{t('docs.field.name_')}} <span *ngIf="formBaseInformation.get('fio_name').value==''||formBaseInformation.get('fio_name').value==null" class="star">*</span></mat-label>
                                                            <input  matInput
                                                                    formControlName="fio_name"
                                                                    [ngClass]="{'is-invalid':formBaseInformation.get('fio_name').touched && formBaseInformation.get('fio_name').invalid}"/>
                                                            <mat-hint *ngIf="formBaseInformation.get('fio_name').touched && formBaseInformation.get('fio_name').invalid" class="invalid-feedback">
                                                                <i class="form-invalid" *ngIf="formBaseInformation.get('fio_name').errors.required">{{t('docs.error.field_miss')}}</i>
                                                            </mat-hint>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-label>{{t('docs.field.surname')}} <span *ngIf="formBaseInformation.get('fio_family').value==''||formBaseInformation.get('fio_family').value==null" class="star">*</span></mat-label>
                                                            <input  matInput
                                                                    formControlName="fio_family"
                                                                    [ngClass]="{'is-invalid':formBaseInformation.get('fio_family').touched && formBaseInformation.get('fio_family').invalid}"/>
                                                            <mat-hint *ngIf="formBaseInformation.get('fio_family').touched && formBaseInformation.get('fio_family').invalid" class="invalid-feedback">
                                                                <i class="form-invalid" *ngIf="formBaseInformation.get('fio_family').errors.required">{{t('docs.error.field_miss')}}</i>
                                                            </mat-hint>
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <mat-form-field class="mat-form-field-100">
                                                    <mat-label>{{t('docs.field.middle_name')}} </mat-label> 
                                                    <input  matInput
                                                            formControlName="fio_otchestvo"
                                                            [ngClass]="{'is-invalid':formBaseInformation.get('fio_otchestvo').touched && formBaseInformation.get('fio_otchestvo').invalid}"/>
                                                    <mat-hint *ngIf="formBaseInformation.get('fio_otchestvo').touched && formBaseInformation.get('fio_otchestvo').invalid" class="invalid-feedback">
                                                    </mat-hint>
                                                </mat-form-field>
                                                <div class="row">
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-label>{{t('docs.field.show_name_as')}} <span *ngIf="formBaseInformation.get('name').value==''||formBaseInformation.get('name').value==null" class="star">*</span></mat-label>
                                                            <input  matInput
                                                                    formControlName="name"
                                                                    [ngClass]="{'is-invalid':formBaseInformation.get('name').touched && formBaseInformation.get('name').invalid}"/>
                                                            <mat-hint *ngIf="formBaseInformation.get('name').touched && formBaseInformation.get('name').invalid" class="invalid-feedback">
                                                                <i class="form-invalid" *ngIf="formBaseInformation.get('name').errors.required">{{t('docs.error.field_miss')}}</i>
                                                            </mat-hint>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-label>{{t('docs.field.date_of_birth')}} </mat-label> 
                                                            <input  matInput 
                                                                    placeholder="{{t('docs.field.date_of_birth')}}"
                                                                    formControlName="date_birthday"
                                                                    [ngClass]="{'is-invalid':formBaseInformation.get('date_birthday').touched && formBaseInformation.get('date_birthday').invalid}"
                                                                    [matDatepicker]="dp"/>
                                                                    <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                                                            <mat-datepicker #dp></mat-datepicker>
                                                            <mat-hint *ngIf="formBaseInformation.get('date_birthday').touched && formBaseInformation.get('date_birthday').invalid" class="invalid-feedback">
                                                                <i class="form-invalid">{{t('docs.error.date_format')}}</i>
                                                            </mat-hint>
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-label>{{t('docs.field.tin')}} </mat-label> 
                                                            <input  matInput
                                                                    placeholder="{{t('docs.field.tin')}}"
                                                                    maxlength="12"
                                                                    (keypress)="numberOnly($event)"
                                                                    formControlName="vatin"
                                                                    [ngClass]="{'is-invalid':formBaseInformation.get('vatin').touched && formBaseInformation.get('vatin').invalid}"/>
                                                                    <mat-hint  align="start" *ngIf="formBaseInformation.get('vatin').touched && formBaseInformation.get('vatin').invalid">
                                                                        <i class="form-invalid">{{t('docs.error.price_format1',{cnt:12})}}</i>
                                                                    </mat-hint>
                                                                    <mat-hint align="end">{{formBaseInformation.get('vatin').value.length}} / 12</mat-hint>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-label>{{t('docs.field.sex')}}</mat-label>
                                                            <mat-select formControlName="sex">
                                                                <option value="" selected></option>
                                                                <mat-option value="male">{{t('docs.list.man')}}</mat-option>
                                                                <mat-option value="female">{{t('docs.list.woman')}}</mat-option>  
                                                            </mat-select>                                              
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <mat-form-field>
                                                    <mat-label>{{t('docs.field.additional')}} </mat-label> 
                                                    <textarea   matInput
                                                            placeholder="{{t('docs.field.additional')}}"
                                                            formControlName="additional"></textarea>
                                                </mat-form-field>


                                                <div *ngIf="isSignUpFailed" class="form-invalid">
                                                    {{t('docs.error.reg_not_compl')}} {{errorMessage}}
                                                </div>

                                            </mat-card-content>
                                        </mat-card>

                                    </div>
                                    <div class="col-lg-4 col-xl-4 col-md-6 col-12">
                                        
                                        <mat-card  appearance="outlined"  class="internal-card">
                                            <mat-card-header>
                                                <mat-card-title class="card-title">{{t('docs.card.account')}}</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form" >

                                                <mat-form-field  [ngClass]="{invisible: +id>0}">
                                                    <mat-label>{{t('docs.field.login')}} <span *ngIf="formBaseInformation.get('username').value==''||formBaseInformation.get('username').value==null" class="star">*</span></mat-label>
                                                    <input matInput 
                                                    formControlName="username" 
                                                    type="text"    
                                                    [ngClass]="{'is-invalid':formBaseInformation.get('username').touched && formBaseInformation.get('username').invalid}"
                                                    [disabled]="+formBaseInformation.get('id').value>0"
                                                    />
                                                    <mat-hint *ngIf="formBaseInformation.get('username').touched && formBaseInformation.get('username').invalid">
                                                        <i *ngIf="formBaseInformation.get('username').errors.required" class="form-invalid">{{t('docs.error.field_miss')}}<br></i>
                                                        <i *ngIf="formBaseInformation.get('username').errors.minlength" class="form-invalid">{{t('docs.error.field_length',{num1:4,num2:20})}}<br></i>
                                                        <i *ngIf="formBaseInformation.get('username').errors.maxlength" class="form-invalid">{{t('docs.error.field_length',{num1:6,num2:20})}}<br></i>
                                                        <i *ngIf="formBaseInformation.get('username').errors.pattern &&
                                                                    !formBaseInformation.get('username').errors.maxlength" class="form-invalid">{{t('docs.error.lgn_must_contain')}}<br></i>
                                                    </mat-hint>
                                                    <mat-hint *ngIf="emptyusername && !formBaseInformation.get('username').touched">
                                                        <i *ngIf="formBaseInformation.get('username').errors.required" class="form-invalid">{{t('docs.error.field_miss')}}<br></i>
                                                    </mat-hint>
                                                </mat-form-field>
                                                
                                                <mat-form-field class="mat-form-field-100" *ngIf="+id>0">
                                                    <mat-label>{{t('docs.field.login')}}</mat-label>
                                                    <input  matInput [readonly]="true"
                                                            [ngModel]="formBaseInformation.get('username').value" [ngModelOptions]="{standalone: true}"/>
                                                </mat-form-field>

                                                <mat-form-field>
                                                    <mat-label>E-mail <span *ngIf="formBaseInformation.get('email').value==''||formBaseInformation.get('email').value==null" class="star">*</span></mat-label>
                                                    <input matInput 
                                                    formControlName="email" 
                                                    autocomplete="off"
                                                    type="text"    
                                                    [ngClass]="{'is-invalid':formBaseInformation.get('email').touched && formBaseInformation.get('email').invalid}"
                                                    />
                                                    <mat-hint *ngIf="formBaseInformation.get('email').touched && formBaseInformation.get('email').invalid">
                                                        <i *ngIf="formBaseInformation.get('email').errors.required" class="form-invalid">{{t('docs.error.field_miss')}}</i>
                                                        <i *ngIf="formBaseInformation.get('email').errors.email" class="form-invalid">{{t('docs.error.email')}}</i>
                                                    </mat-hint>
                                                    <mat-hint *ngIf="emptyEmail && !formBaseInformation.get('email').touched">
                                                        <i *ngIf="formBaseInformation.get('email').errors.required" class="form-invalid">{{t('docs.error.field_miss')}}</i>
                                                    </mat-hint>
                                                </mat-form-field>
                                                <mat-form-field *ngIf="+formBaseInformation.get('id').value == 0">
                                                    <mat-label>{{t('docs.field.password')}} <span *ngIf="formBaseInformation.get('password').value==''||formBaseInformation.get('password').value==null" class="star">*</span></mat-label>
                                                    <input type="text" 
                                                    autocomplete="off"
                                                    matInput         
                                                    placeholder="{{t('docs.field.password')}}" 
                                                    formControlName="password"  
                                                    [ngClass]="{'is-invalid':formBaseInformation.get('password').touched && formBaseInformation.get('password').invalid}"
                                                    />
                                                    <mat-hint *ngIf="formBaseInformation.get('password').touched && formBaseInformation.get('password').invalid">
                                                        <i *ngIf="formBaseInformation.get('password').errors.required" class="form-invalid">{{t('docs.error.field_miss')}}<br></i>
                                                        <i *ngIf="formBaseInformation.get('password').errors.minlength" class="form-invalid">{{t('docs.error.field_length',{num1:6,num2:20})}}<br></i>
                                                        <i *ngIf="formBaseInformation.get('password').errors.maxlength" class="form-invalid">{{t('docs.error.field_length',{num1:6,num2:20})}}<br></i>
                                                        <i *ngIf="formBaseInformation.get('password').errors.pattern &&
                                                                    !formBaseInformation.get('password').errors.maxlength" class="form-invalid">{{t('docs.error.pwd_must_contain')}}<br></i>
                                                    </mat-hint>
                                                    <mat-hint *ngIf="emptyPassword && !formBaseInformation.get('password').touched">
                                                        <i *ngIf="formBaseInformation.get('password').errors.required" class="form-invalid">{{t('docs.error.field_miss')}}<br></i>
                                                    </mat-hint>
                                                </mat-form-field>
                                                <mat-form-field>
                                                    <mat-label>{{t('docs.field.acc_status')}}</mat-label>
                                                    <mat-select formControlName="status_account">
                                                        
                                                        <mat-option [value]=1>{{t('docs.list.email_notver')}}</mat-option>
                                                        <mat-option [value]=2>{{t('docs.list.active')}}</mat-option>
                                                        <mat-option [value]=3>{{t('docs.list.blocked')}}</mat-option>
                                                        <mat-option [value]=4>{{t('docs.list.deleted_arch')}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </mat-card-content>
                                        </mat-card>
                                        <mat-card  appearance="outlined"  class="internal-card">
                                            <mat-card-header>
                                                <mat-card-title class="card-title">{{t('docs.card.perm_n_access')}}</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form">
                                                <mat-form-field class="mat-form-field-100" *ngIf="+id==0">
                                                    <mat-label>{{t('docs.field.user_company')}} <span *ngIf="formBaseInformation.get('company_id').value==''||formBaseInformation.get('company_id').value==null" class="star">*</span></mat-label>
                                                    <mat-select  formControlName="company_id" (selectionChange)="onCompanyChange()">                          
                                                            <mat-option  *ngFor="let rt of receivedCompaniesList" [value]="rt.id">
                                                                    {{rt.name}}
                                                            </mat-option> 
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-form-field class="mat-form-field-100" *ngIf="+id>0">
                                                    <mat-label>{{t('docs.field.user_company')}}</mat-label>
                                                    <input  matInput [readonly]="true"
                                                            [ngModel]="formAboutDocument.get('company').value" [ngModelOptions]="{standalone: true}"/>
                                                </mat-form-field>
                                                <mat-form-field>
                                                    <mat-label>{{t('docs.field.user_departs')}} <span *ngIf="formBaseInformation.get('selectedUserDepartments').value.length==0||formBaseInformation.get('selectedUserDepartments').value==null" class="star">*</span></mat-label>
                                                    <mat-select formControlName="selectedUserDepartments" multiple>
                                                        <mat-option *ngFor="let department of receivedDepartmentsList" 
                                                                    [value]="department.id">
                                                                    {{department.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <mat-form-field>
                                                    <mat-label>{{t('docs.field.roles')}} <span *ngIf="formBaseInformation.get('userGroupList').value.length==0||formBaseInformation.get('userGroupList').value==null" class="star">*</span></mat-label>
                                                    <mat-select formControlName="userGroupList" multiple>
                                                        <mat-option *ngFor="let group of receivedUserGroupList" 
                                                                    [value]="group.id">
                                                                    {{group.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                
                                            </mat-card-content>
                                        </mat-card>
                                    </div>

                                    <div class="col-lg-4 col-xl-4 col-md-6 col-12">
                                        
                                        <mat-card  appearance="outlined"  class="internal-card"  [ngClass]="{invisible: +id>0}">
                                            <mat-card-header>
                                                <mat-card-title class="card-title">{{t('docs.card.lang_n_stand')}}</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form">
                                                <mat-form-field  style="display: none;" >
                                                    <input   matInput
                                                            placeholder="{{t('docs.field.time_zone')}}"
                                                            formControlName="timeZoneId"/>
                                                </mat-form-field>
                                                <mat-form-field class="mat-form-field-100">
                                                    <mat-label>{{t('modules.field.language')}} <span *ngIf="formBaseInformation.get('languageName').value==0||formBaseInformation.get('languageName').value==null" class="star">*</span></mat-label>
                                                    <input matInput
                                                        type="text"
                                                        formControlName="languageName" 
                                                        [matAutocomplete]="lg" 
                                                        (input)="checkEmptyFields('languageId','languageName');"
                                                        (change)="checkEmptyFields('languageId','languageName');">
                                                    <button 
                                                        type="button"
                                                        class="clear-button"
                                                        (click)="clearField('languageName');checkEmptyFields('languageId','languageName');"
                                                        matTooltip="{{t('docs.tip.clear_field')}}"
                                                        matSuffix mat-icon-button>
                                                        <mat-icon>close</mat-icon>
                                                    </button>
                                                    <mat-autocomplete #lg="matAutocomplete">
                                                    <mat-option *ngFor="let option of filteredSpravSysLanguages | async" [value]="option.name">
                                                        <div (click)="formBaseInformation.get('languageId').setValue(option.id)">
                                                            <span style="margin:10px;">{{option.name}}</span>
                                                        </div>
                                                    </mat-option>
                                                    </mat-autocomplete>
                                                    <mat-hint  align="start" *ngIf="formBaseInformation.get('languageName').touched && formBaseInformation.get('languageId').invalid">
                                                        <i class="form-invalid">{{t('docs.error.field_miss')}}</i>
                                                    </mat-hint>
                                                </mat-form-field>
                    
                                                <mat-form-field style="display: none;" >
                                                    <input   matInput
                                                            placeholder="locale"
                                                            formControlName="localeId"/>
                                                </mat-form-field>
                                                <mat-form-field class="mat-form-field-100">
                                                    <mat-label>{{t('modules.field.locale')}} <span *ngIf="formBaseInformation.get('localeName').value==0||formBaseInformation.get('localeName').value==null" class="star">*</span></mat-label>
                                                    <input matInput
                                                        type="text"
                                                        formControlName="localeName" 
                                                        [matAutocomplete]="lc" 
                                                        (input)="checkEmptyFields('localeId','localeName');"
                                                        (change)="checkEmptyFields('localeId','localeName');">
                                                    <button 
                                                        type="button"
                                                        class="clear-button"
                                                        (click)="clearField('localeName');checkEmptyFields('localeId','localeName');"
                                                        matTooltip="{{t('docs.tip.clear_field')}}"
                                                        matSuffix mat-icon-button>
                                                        <mat-icon>close</mat-icon>
                                                    </button>
                                                    <mat-autocomplete #lc="matAutocomplete">
                                                    <mat-option *ngFor="let option of filteredSpravSysLocales | async" [value]="option.name">
                                                        <div (click)="formBaseInformation.get('localeId').setValue(option.id)">
                                                            <span style="margin:10px;">{{option.name}}</span>
                                                        </div>
                                                    </mat-option>
                                                    </mat-autocomplete>
                                                    <mat-hint  align="start" *ngIf="formBaseInformation.get('localeName').touched && formBaseInformation.get('localeId').invalid">
                                                        <i class="form-invalid">{{t('docs.error.field_miss')}}</i>
                                                    </mat-hint>
                                                </mat-form-field>
                                                <mat-form-field>
                                                    <mat-label>{{t('docs.field.time_zone')}} <span *ngIf="formBaseInformation.get('timeZoneName').value==0||formBaseInformation.get('timeZoneName').value==null" class="star">*</span></mat-label>
                                                    <input matInput
                                                    type="text"
                                                    formControlName="timeZoneName" 
                                                    [matAutocomplete]="auto" 
                                                    (input)="checkEmptyFields('timeZoneId','timeZoneName');"
                                                    (change)="checkEmptyFields('timeZoneId','timeZoneName');">
                                                    <button 
                                                        type="button"
                                                        class="clear-button"
                                                        (click)="clearField('timeZoneName');checkEmptyFields('timeZoneId','timeZoneName');"
                                                        matTooltip="{{t('docs.tip.clear_field')}}"
                                                        matSuffix mat-icon-button>
                                                        <mat-icon>close</mat-icon>
                                                    </button>
                                                    <mat-autocomplete #auto="matAutocomplete">
                                                    <mat-option *ngFor="let option of filteredSpravSysTimeZones | async" [value]="option.name">
                                                        <div (click)="formBaseInformation.get('timeZoneId').setValue(option.id)">
                                                            <span style="margin:10px;">{{option.name}}</span>
                                                        </div>
                                                    </mat-option>
                                                    </mat-autocomplete>
                                                    <mat-hint  align="start" *ngIf="formBaseInformation.get('timeZoneName').touched && formBaseInformation.get('timeZoneId').invalid">
                                                        <i class="form-invalid">{{t('docs.error.field_miss')}}</i>
                                                    </mat-hint>
                                                </mat-form-field>
                                            </mat-card-content>
                                        </mat-card>
                                    </div>
                                </div>
                            </div>
                        </mat-tab>



                        <mat-tab label="{{t('docs.tab.employee')}}">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-lg-4 col-xl-4 col-md-12">  
                                        <mat-card appearance="outlined" class="internal-card">
                                            <div 
                                                class="logo"
                                                (click)="uploadAvatar()"
                                                [ngStyle]="{'background-image': 'url(' + logoImage + ')'}"
                                            >
                                                <span class="material-icons" *ngIf="logoImage==''">
                                                    photo_camera
                                                </span>
                                            </div>
                                            <mat-card-header>
                                                <mat-card-title class="card-title">{{t('docs.card.employee_info')}}</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form">
                                                
                                                <mat-form-field style="display: none;" >
                                                    <input   matInput
                                                            formControlName="job_title_id"/>
                                                </mat-form-field>
                                                
                                                <div class="row">
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-slide-toggle 
                                                            #is_employee
                                                            formControlName="is_employee"
                                                            (change)="is_employee_toggle($event)"
                                                            >{{t('docs.field.is_employee')}}</mat-slide-toggle>
                                                            <input matInput hidden/>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-slide-toggle 
                                                            formControlName="is_currently_employed"
                                                            (change)="is_currently_employed_toggle($event)"
                                                            >{{t('docs.field.curr_employed')}}</mat-slide-toggle>
                                                            <input matInput hidden/>
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-slide-toggle 
                                                            #is_business_card
                                                            formControlName="is_business_card"
                                                            (change)="is_business_card_toggle($event)"
                                                            >{{t('docs.field.is_business_card')}}</mat-slide-toggle>
                                                            <input matInput hidden/>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-lg-6 col-sm-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-slide-toggle 
                                                            #is_display_in_employee_list
                                                            (change)="is_provide_services_toggle($event)"
                                                            formControlName="is_display_in_employee_list"
                                                            >{{t('docs.field.displ_empl_lst')}}</mat-slide-toggle>
                                                            <input matInput hidden/>
                                                            
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <mat-form-field class="mat-form-field-100">
                                                            <mat-slide-toggle 
                                                            formControlName="is_online_booking"
                                                            >{{t('docs.field.is_online_booking')}}</mat-slide-toggle>
                                                            <input matInput hidden/>
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <mat-form-field class="mat-form-field-100" *ngIf="formBaseInformation.get('is_employee').value">
                                                    <mat-label>{{t('docs.field.job_title')}} <span *ngIf="formBaseInformation.get('is_employee').value && +formBaseInformation.get('job_title_id').value==0" class="star">*</span></mat-label>
                                                    <input matInput
                                                        type="text"
                                                        formControlName="job_title_name" 
                                                        [matAutocomplete]="jt" 
                                                        (input)="checkEmptyFields('job_title_id','job_title_name');"
                                                        (change)="checkEmptyFields('job_title_id','job_title_name');">
                                                    <mat-icon   
                                                            *ngIf="formBaseInformation.get('job_title_name').value!==''"
                                                            matTooltip="{{t('docs.tip.select')}}"
                                                            class="del-file"
                                                            (click)="clearField('job_title_name'); checkEmptyFields('job_title_id','job_title_name');"
                                                            matTooltip="{{t('modules.tip.clr_srch')}}"      >
                                                            close
                                                    </mat-icon>
                                                    <mat-autocomplete #jt="matAutocomplete">
                                                    <mat-option *ngFor="let option of filteredJobtitles | async" [value]="option.name">
                                                        <div (click)="formBaseInformation.get('job_title_id').setValue(option.jobtitle_id)">
                                                            <span style="margin:10px;">{{option.name}}</span>
                                                        </div>
                                                    </mat-option>
                                                    </mat-autocomplete>
                                                </mat-form-field>
                                                <mat-form-field style="display: none">
                                                    <input  matInput
                                                            placeholder="counterparty_id"
                                                            formControlName="counterparty_id"/>
                                                </mat-form-field>
                                                <mat-form-field class="mat-form-field-100" *ngIf="formBaseInformation.get('is_employee').value"> 
                                                    <mat-label>{{t('modules.field.counterparty')}}</mat-label>
                                                    <input  matInput 
                                                    placeholder="{{formBaseInformation.get('counterparty_id').value==null?t('modules.field.counterparty_srch'):t('modules.field.counterparty')}}"
                                                    [matAutocomplete]="auto4" 
                                                    [formControl]="searchCagentCtrl"
                                                    matTooltip="{{t('docs.tip.employee_cagent')}}"
                                                    (input)="canCagentAutocompleteQuery=true; checkEmptyCagentField();"
                                                    (change)="canCagentAutocompleteQuery=false; checkEmptyCagentField();">
                                                    <mat-icon   
                                                        *ngIf="editability && +formBaseInformation.get('counterparty_id').value!==0"
                                                        matTooltip="{{t('docs.tip.select')}}"
                                                        class="del-file"
                                                        (click)="searchCagentCtrl.setValue('');formBaseInformation.get('counterparty_id').setValue(null);onClickDeleteIncomingService()"
                                                        matTooltip="{{t('modules.tip.clr_srch')}}"      >
                                                        close
                                                    </mat-icon>                                                    
                                                    <mat-icon
                                                        *ngIf="editability && +formBaseInformation.get('counterparty_id').value==0"
                                                        matTooltip="{{t('docs.tip.crte_usr_cgnt')}}"
                                                        class="add_circle"
                                                        (click)="insertUserCagent()">
                                                        add_circle_outline
                                                    </mat-icon>
                                                    <mat-autocomplete #auto4="matAutocomplete">
                                                    <ng-container *ngIf="!isCagentListLoading" style="width:320px;">
                                                        <mat-option style="padding:0px" *ngFor="let value of filteredCagents" [value]="value.name">
                                                        <div (click)="onSelectCagent(value.id,value.name)">
                                                            <span style="margin:10px;"><b>{{value.name}}</b></span>
                                                        </div>
                                                        </mat-option>
                                                    </ng-container>
                                                    </mat-autocomplete>
                                                </mat-form-field>

                                                <mat-form-field class="mat-form-field-100" [ngClass]="{invisible: true}">
                                                    <input  matInput
                                                            formControlName="incoming_service_id">
                                                </mat-form-field>
                                                <mat-form-field 
                                                    class="mat-form-field-100" 
                                                    *ngIf="formBaseInformation.get('is_employee').value && +formBaseInformation.get('counterparty_id').value>0">
                                                    <mat-label>{{t('docs.field.incoming_service')}} 
                                                        <!-- <span *ngIf="+formBaseInformation.get('counterparty_id').value>0 &&+formBaseInformation.get('incoming_service_id').value==0" class="star">*</span> -->
                                                    </mat-label>
                                                    <div *ngIf="editability && +formBaseInformation.get('incoming_service_id').value==0">
                                                       <mat-icon   
                                                            matTooltip="{{t('docs.tip.select')}}"
                                                            class="add_circle"
                                                            (click)="onClickSelectIncomingService()">
                                                            add_circle_outline
                                                        </mat-icon>
                                                    </div>
                                                    <div style="min-width:70px;">
                                                        <mat-icon 
                                                                *ngIf="editability && +formBaseInformation.get('incoming_service_id').value>0"
                                                                class="del-file"
                                                                (click)="onClickDeleteIncomingService()"
                                                                matTooltip="{{t('modules.tip.clr_srch')}}"
                                                                >
                                                            <mat-icon>close</mat-icon>
                                                        </mat-icon>
                                                    </div>
                                                    <input  matInput
                                                            matTooltip="{{t('docs.tip.empl_incom_service')}}"
                                                            formControlName="incoming_service_name" 
                                                            [readonly]="true">
                                                </mat-form-field>

                                                
                                                <mat-progress-bar *ngIf="isCagentListLoading" mode="indeterminate"></mat-progress-bar>
                                            </mat-card-content>
                                        </mat-card>
                                    </div>
                                    <div class="col-lg-4 col-xl-4 col-md-12">

                                        <mat-card appearance="outlined" class="internal-card" *ngIf="formBaseInformation.get('is_employee').value && formBaseInformation.get('is_display_in_employee_list').value">
                                            <mat-card-header>
                                                <mat-card-title>
                                                    <div class="flex card">
                                                        <div style="width:100%;">
                                                            {{t('docs.card.employee_services')}}
                                                        </div>
                                                        <div>
                                                            <!-- <button 
                                                                mat-raised-button 
                                                                (click)="
                                                                showSearchFormFields=!showSearchFormFields;
                                                                refreshTableColumns();"
                                                                type="button"
                                                                *ngIf="!showSearchFormFields && editability"
                                                                color="primary"
                                                                class="button">
                                                                {{t('docs.tip.p_edit')}}
                                                            </button> -->
                                                            <!-- <button matTooltip="{{t('docs.tip.p_edit')}}" 
                                                                        mat-mini-fab 
                                                                        color="primary" 
                                                                        *ngIf="!showSearchFormFields && editability"
                                                                        (click)="
                                                                        showSearchFormFields=!showSearchFormFields;
                                                                        refreshTableColumns();">
                                                                    <mat-icon>edit</mat-icon>
                                                            </button> -->
                                                        </div>
                                                    </div>
                                                </mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form" style="padding: 15px;">
        
                                                <div class="row" *ngIf="getControl('userProducts').value.length>0 || gettingTableData" style="margin-right:0;margin-left:0;">
                                                    <mat-spinner 
                                                    strokeWidth="3" 
                                                    class="spinner"
                                                    [diameter]="44"
                                                    *ngIf="gettingTableData"
                                                    ></mat-spinner>
                                                    <table mat-table #_table  
                                                    [dataSource]="getControl('userProducts').value" 
                                                    [formGroup]="formBaseInformation" 
                                                    [trackBy]="trackByIndex"
                                                    style="margin: 20px 0 30px;"
                                                    class="mat-elevation-z8 jobtitles-table product-table">
                    
                                                        <ng-container matColumnDef="select" [formArrayName]="'userProducts'">
                                                            <th mat-header-cell *matHeaderCellDef class="checkbox-col">
                                                                <!--mat-checkbox   (change)="masterToggle()"
                                                                                
                                                                                [checked]="selection.hasValue()"
                                                                                [indeterminate]="selection.hasValue() && !isAllSelected()">
                                                                </mat-checkbox-->
                                                            </th>
                                                            <td mat-cell class="checkbox-col" *matCellDef="let row; let i = index" [formGroupName]="i"> 
                                                                <!--mat-checkbox   (click)="$event.stopPropagation()"
                                                                                *ngIf="showCheckbox(row)"
                                                                                
                                                                                (change)="$event ? clickTableCheckbox(row) : null"
                                                                                [checked]="selection.isSelected(row)">
                                                                </mat-checkbox-->
                                                            </td>
                                                        </ng-container>
        
                                                        <!-- Name of department part Column -->
                                                        <ng-container matColumnDef="name" [formArrayName]="'userProducts'">
                                                            <th mat-header-cell *matHeaderCellDef style="width: 100%;">{{t('modules.col.service_name')}}</th>
                                                            <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i"> 
                                                                <span>{{row.name}}</span>
                                                            </td>
                                                        </ng-container>
                                                        
                                                        <!-- <ng-container matColumnDef="dep_parts" [formArrayName]="'userProducts'">
                                                            <th mat-header-cell *matHeaderCellDef>{{t('docs.card.dep_parts')}}</th>
                                                            <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i"> 
                                                                <mat-form-field style="width: 100%;">
                                                                    <mat-label>{{t('docs.card.dep_parts')}}</mat-label>
                                                                    <mat-select
                                                                        panelClass="department-list"
                                                                        formControlName="dep_parts_ids"
                                                                        #select
                                                                        multiple>
                                                                        <div class="button-row">
                                                                            <button 
                                                                                mat-icon-button 
                                                                                matTooltip="{{t('docs.tip.select_all')}}" 
                                                                                color="primary"
                                                                                (click)="selectAllDepParts(i)"
                                                                            >
                                                                              <mat-icon>fact_check</mat-icon>
                                                                            </button>
                                                                            <button 
                                                                                mat-icon-button 
                                                                                matTooltip="{{t('docs.tip.unselect_all')}}" 
                                                                                color="primary"
                                                                                (click)="unselectAllDepParts(i)">
                                                                              <mat-icon>ballot</mat-icon>
                                                                            </button>
                                                                        </div>
                                                                        <mat-optgroup 
                                                                            *ngFor="let department of receivedDepartmentsWithPartsList;"
                                                                            [label]="department.department_name"
                                                                        >
                                                                            <button 
                                                                                mat-icon-button 
                                                                                matTooltip="{{t('docs.tip.select_all_onedep')}}" 
                                                                                color="primary"
                                                                                (click)="selectAllDepPartsOneDep(i,department.department_id)"
                                                                            >
                                                                              <mat-icon>fact_check</mat-icon>
                                                                            </button>
                                                                            <button 
                                                                                mat-icon-button 
                                                                                matTooltip="{{t('docs.tip.unselect_all_onedep')}}" 
                                                                                color="primary" 
                                                                                (click)="unselectAllDepPartsOneDep(i,department.department_id)">
                                                                              <mat-icon>ballot</mat-icon>
                                                                            </button>
                                                                            <mat-option
                                                                                *ngFor= "let part of department.parts;"
                                                                                [value]="part.id"
                                                                                [matTooltip]="part.description"
                                                                                [matTooltipPosition]="'right'"
                                                                            >
                                                                                {{part.name}}
                                                                            </mat-option>
                                                                        </mat-optgroup>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </td>
                                                            <td mat-footer-cell *matFooterCellDef></td>
                                                        </ng-container> -->
                                                        <!-- Delete Column -->
                                                        <ng-container matColumnDef="delete" [formArrayName]="'userProducts'">
                                                            <th mat-header-cell *matHeaderCellDef style="width: 30px;"><mat-icon style="cursor: default" (click)="clearTable()" matTooltip="{{t('docs.tip.delete_all_rows')}}">close</mat-icon></th>
                                                            <td mat-cell style="width: 30px;" *matCellDef="let row; let i = index" [formGroupName]="i">
                                                                <mat-icon style="cursor: default" (click)="deleteTableRow(row,i)">delete_forever</mat-icon>
                                                            </td>
                                                        </ng-container>
        
                                                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        
        
        
                                                    </table> 
                                                </div>
                                                <div class="row">
                                                    <div class="col-12" [style.display]="((allowToCreate && +id==0)||(allowToUpdate && id>0)) ?'block':'none'">
                                                        <div class="center hand" style="width:100%; height: 38px;">
                                                            <button matTooltip="{{t('docs.tip.add_row')}}" 
                                                                    mat-mini-fab color="primary" 
                                                                    (click)="openDialogProductCategoriesSelect('products','employee_services')" >
                                                                <mat-icon>add</mat-icon>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- <div class="row">
                                                    <div class="col-12" [style.display]="((allowToCreate && +id==0)||(allowToUpdate && id>0)) ?'block':'none'">
                                                        <div class="center hand" style="width:100%; height: 38px;">
                                                            <button matTooltip="{{t('docs.tip.add_row')}}" 
                                                                    mat-mini-fab color="primary" 
                                                                    (click)="sortBy('id')" >
                                                                ID
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div><div class="row">
                                                    <div class="col-12" [style.display]="((allowToCreate && +id==0)||(allowToUpdate && id>0)) ?'block':'none'">
                                                        <div class="center hand" style="width:100%; height: 38px;">
                                                            <button matTooltip="{{t('docs.tip.add_row')}}" 
                                                                    mat-mini-fab color="primary" 
                                                                    (click)="sortBy('name')" >
                                                                Name
                                                            </button>
                                                        </div>
                                                    </div> 
                                                </div>-->
                                                
                                            </mat-card-content>
                                        </mat-card>

                                    </div>

                                    <div class="col-lg-4 col-xl-4 col-md-12">
                                        <mat-card appearance="outlined" class="internal-card"
                                        [ngStyle]="!formBaseInformation.get('is_business_card').value?{'display':'none'}:{}"
                                        >
                                            <mat-card-header>
                                                <mat-card-title>{{t('docs.card.contacts')}}</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content class="input-form">
        
                                                <app-contacts
                                                    [companyId]="formBaseInformation.get('company_id').value"
                                                    [userId]="id"
                                                    [editability]="editability">
                                                </app-contacts>

                                            </mat-card-content>
                                        </mat-card>
                                    </div>

                                </div>
                            </div>
                        </mat-tab>



                        <mat-tab  *ngIf="+id>0"  label="{{t('docs.tab.about')}}">
                            <form [formGroup]="formAboutDocument">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-lg-4 col-xl-4 col-md-6 col-12">
                                            <mat-card  appearance="outlined"  class="internal-card">
                                                <mat-card-content class="input-form"  style="padding: 10px;">
                                                        <mat-form-field [ngClass]="{invisible: +id==0}">
                                                            <input  matInput
                                                                    placeholder="{{t('docs.field.company')}}"
                                                                    formControlName="company" [readonly]=true/>
                                                        </mat-form-field>
                                                        <mat-form-field [ngClass]="{invisible: +id==0}">
                                                            <input  matInput
                                                                    placeholder="{{t('docs.field.creator')}}"
                                                                    formControlName="creator" [readonly]=true/>
                                                        </mat-form-field>
                                                        <mat-form-field [ngClass]="{invisible: +id==0}">
                                                            <input  matInput
                                                                    placeholder="{{t('docs.field.created')}}"
                                                                    formControlName="date_time_created" [readonly]=true/>
                                                        </mat-form-field>
                                                        <mat-form-field [ngClass]="{invisible: +id==0}">
                                                            <input  matInput
                                                                    placeholder="{{t('docs.field.changer')}}"
                                                                    formControlName="changer" [readonly]=true/>
                                                        </mat-form-field>
                                                        <mat-form-field [ngClass]="{invisible: +id==0}">
                                                            <input  matInput
                                                                    placeholder="{{t('docs.field.changed')}}"
                                                                    formControlName="date_time_changed" [readonly]=true/>
                                                        </mat-form-field>
                                                </mat-card-content>
                                            </mat-card>
                                        </div>
                                    </div>
                                </div>
                            </form>  
                        </mat-tab>

                </mat-tab-group>

        </form>

        <!-- <code><pre>{{formBaseInformation.value | json}}</pre></code> -->
    </mat-card-content> 
</mat-card>

